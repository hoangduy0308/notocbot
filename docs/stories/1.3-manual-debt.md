# Story 1.3: Manual Debt Recording (Lá»‡nh /add)

**Tráº¡ng thÃ¡i:** Approved ðŸŸ¢

## 1. User Story
* **LÃ :** NgÆ°á»i dÃ¹ng
* **TÃ´i muá»‘n:** Ghi láº¡i má»™t khoáº£n ná»£ báº±ng lá»‡nh rÃµ rÃ ng (vÃ­ dá»¥: `/add @Tuan 50000 tien cafe`).
* **Äá»ƒ:** LÆ°u thÃ´ng tin ná»£ vÃ o há»‡ thá»‘ng má»™t cÃ¡ch chÃ­nh xÃ¡c mÃ  chÆ°a cáº§n AI thÃ´ng minh.

## 2. Acceptance Criteria (TiÃªu chÃ­ cháº¥p nháº­n)
1. Bot nháº­n diá»‡n lá»‡nh `/add` vá»›i tham sá»‘: `[TÃªn] [Sá»‘ tiá»n] [Ghi chÃº]`.
2. **Logic User:** Náº¿u ngÆ°á»i chat chÆ°a cÃ³ trong báº£ng `users`, tá»± Ä‘á»™ng táº¡o má»›i.
3. **Logic Debtor:** TÃ¬m trong báº£ng `debtors` cá»§a user Ä‘Ã³ xem cÃ³ ai tÃªn Ä‘Ã³ chÆ°a. Náº¿u chÆ°a -> Táº¡o má»›i. Náº¿u cÃ³ -> Láº¥y ID cÅ©.
4. **Logic Transaction:** LÆ°u má»™t dÃ²ng vÃ o báº£ng `transactions` vá»›i `amount` dÆ°Æ¡ng, `type='DEBT'`.
5. **Pháº£n há»“i:** Bot tráº£ lá»i xÃ¡c nháº­n: *"ÄÃ£ ghi ná»£ [TÃªn]: [Sá»‘ tiá»n] (LÃ½ do: [Ghi chÃº])"*.
6. **Xá»­ lÃ½ lá»—i:** Náº¿u nháº­p sai cÃº phÃ¡p (thiáº¿u tiá»n, sai Ä‘á»‹nh dáº¡ng), Bot bÃ¡o lá»—i hÆ°á»›ng dáº«n.

## 3. Tasks (Nhiá»‡m vá»¥ cá»¥ thá»ƒ)
* [x] Táº¡o file `src/utils/formatters.py`: HÃ m `parse_amount(text)` Ä‘á»ƒ xá»­ lÃ½ `50k` -> `50000`.
* [x] Táº¡o file `src/services/user_service.py`: HÃ m `get_or_create_user`.
* [x] Táº¡o file `src/services/debtor_service.py`: HÃ m `get_or_create_debtor`.
* [x] Táº¡o file `src/services/debt_service.py`: HÃ m `add_transaction`.
* [x] Cáº­p nháº­t `src/bot/handlers.py`:
    * ThÃªm hÃ m `add_command`.
    * Parse arguments (`context.args`).
    * Gá»i cÃ¡c Service trÃªn theo thá»© tá»± logic.
* [x] ÄÄƒng kÃ½ `add_handler` trong `src/main.py`.

## 4. Dev Notes
* **Format tiá»n:** HÃ£y há»— trá»£ chá»¯ "k" (vÃ­ dá»¥ 50k = 50000).
* **Validation:** Äáº£m báº£o sá»‘ tiá»n pháº£i > 0.
* **User Context:** Láº¥y `telegram_id` vÃ  `full_name` tá»« `update.effective_user`.