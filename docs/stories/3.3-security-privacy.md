# Story 3.3: Security & Privacy Scope (Báº£o máº­t & RiÃªng tÆ°)

**Tráº¡ng thÃ¡i:** Approved ğŸŸ¢

## 1. User Story
* **LÃ :** NgÆ°á»i dÃ¹ng
* **TÃ´i muá»‘n:** Dá»¯ liá»‡u tÃ i chÃ­nh cá»§a tÃ´i Ä‘Æ°á»£c báº£o máº­t tuyá»‡t Ä‘á»‘i, ngÆ°á»i dÃ¹ng khÃ¡c sá»­ dá»¥ng bot nÃ y khÃ´ng thá»ƒ xem trá»™m hoáº·c thao tÃ¡c lÃªn sá»• ná»£ cá»§a tÃ´i.
* **Äá»ƒ:** Äáº£m báº£o tÃ­nh riÃªng tÆ° vÃ  an toÃ n dá»¯ liá»‡u.

## 2. Acceptance Criteria (TiÃªu chÃ­ cháº¥p nháº­n)
1. **NguyÃªn táº¯c Multi-tenancy:** Má»i truy váº¥n Database (SELECT, INSERT, UPDATE, DELETE) liÃªn quan Ä‘áº¿n `Debtor`, `Alias`, `Transaction` **Báº®T BUá»˜C** pháº£i cÃ³ Ä‘iá»u kiá»‡n lá»c theo `user_id`.
2. **Middleware/Decorator:** CÃ³ cÆ¡ cháº¿ tá»± Ä‘á»™ng láº¥y `user_id` tá»« tin nháº¯n Telegram (`update.effective_user.id`) vÃ  truyá»n xuá»‘ng táº§ng Service má»™t cÃ¡ch an toÃ n.
3. **Validation Test:**
    * Scenario: User A (ID 111) thÃªm ná»£ cho "Tuan". User B (ID 222) chat `/balance Tuan`.
    * Káº¿t quáº£ ká»³ vá»ng: User B nháº­n thÃ´ng bÃ¡o "KhÃ´ng tÃ¬m tháº¥y Tuan" (hoáº·c sá»‘ dÆ° 0), tuyá»‡t Ä‘á»‘i khÃ´ng hiá»‡n sá»‘ liá»‡u cá»§a A.

## 3. Tasks (Nhiá»‡m vá»¥ cá»¥ thá»ƒ)
* [ ] **Audit Code (RÃ  soÃ¡t):** Kiá»ƒm tra ká»¹ cÃ¡c file `src/services/debtor_service.py` vÃ  `debt_service.py`. Äáº£m báº£o táº¥t cáº£ cÃ¡c hÃ m query Ä‘á»u nháº­n tham sá»‘ `user_id` vÃ  dÃ¹ng nÃ³ trong má»‡nh Ä‘á» `.where(Debtor.user_id == user_id)`.
* [ ] **Refactor (Náº¿u cáº§n):** Náº¿u phÃ¡t hiá»‡n hÃ m nÃ o "quÃªn" check `user_id` (vÃ­ dá»¥ hÃ m tÃ¬m Alias), hÃ£y sá»­a ngay láº­p tá»©c.
* [ ] **Security Test Script:** Viáº¿t má»™t Ä‘oáº¡n script nhá» hoáº·c Unit Test mÃ´ phá»ng viá»‡c gá»i hÃ m vá»›i 2 `user_id` khÃ¡c nhau Ä‘á»ƒ chá»©ng minh dá»¯ liá»‡u bá»‹ cÃ´ láº­p.

## 4. Dev Notes
* **SQLAlchemy Filter:** HÃ£y cháº¯c cháº¯n dÃ¹ng `filter` hoáº·c `where` á»Ÿ má»i cÃ¢u query.
* **Alias Security:** ChÃº Ã½ báº£ng `aliases` liÃªn káº¿t vá»›i `debtors`. Khi query alias, pháº£i join vá»›i `debtors` vÃ  check `debtors.user_id`.