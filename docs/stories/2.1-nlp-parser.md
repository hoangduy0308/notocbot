# Story 2.1: Basic NLP Parser (X·ª≠ l√Ω ng√¥n ng·ªØ t·ª± nhi√™n)

**Tr·∫°ng th√°i:** Approved üü¢

## 1. User Story
* **L√†:** Ng∆∞·ªùi d√πng
* **T√¥i mu·ªën:** Chat t·ª± nhi√™n nh∆∞ "Tu·∫•n n·ª£ 50k ti·ªÅn c∆°m" ho·∫∑c "Tu·∫•n tr·∫£ 20k" m√† kh√¥ng c·∫ßn d√πng l·ªánh `/add` hay `/paid`.
* **ƒê·ªÉ:** Thao t√°c nhanh h∆°n, t·ª± nhi√™n h∆°n, gi·ªëng nh∆∞ ƒëang nh·∫Øn tin v·ªõi b·∫°n b√®.

## 2. Acceptance Criteria (Ti√™u ch√≠ ch·∫•p nh·∫≠n)
1. Bot nh·∫≠n di·ªán ƒë∆∞·ª£c tin nh·∫Øn vƒÉn b·∫£n th∆∞·ªùng (kh√¥ng c√≥ d·∫•u `/`).
2. **Nh·∫≠n di·ªán Ghi n·ª£:**
    * M·∫´u c√¢u: `[T√™n] (n·ª£/vay/mu·ªôn) [S·ªë ti·ªÅn] [Ghi ch√∫]`.
    * V√≠ d·ª•: "Tu·∫•n n·ª£ 50k", "Lan vay 100.000".
    * H√†nh ƒë·ªông: G·ªçi logic ghi n·ª£ (t∆∞∆°ng t·ª± `/add`).
3. **Nh·∫≠n di·ªán Tr·∫£ n·ª£:**
    * M·∫´u c√¢u: `[T√™n] (tr·∫£/ƒë∆∞a/b√π) [S·ªë ti·ªÅn]`.
    * V√≠ d·ª•: "Tu·∫•n tr·∫£ 20k", "Lan ƒë∆∞a 50000".
    * H√†nh ƒë·ªông: G·ªçi logic tr·∫£ n·ª£ (t∆∞∆°ng t·ª± `/paid`).
4. **X·ª≠ l√Ω ti·ªÅn:** H·ªó tr·ª£ ƒë·ªãnh d·∫°ng `50k`, `50.000`, `50,000`.
5. **Fallback:** N·∫øu tin nh·∫Øn kh√¥ng kh·ªõp m·∫´u n√†o, Bot **l·ªù ƒëi** (kh√¥ng ph·∫£n h·ªìi g√¨) ƒë·ªÉ tr√°nh spam.

## 3. Tasks (Nhi·ªám v·ª• c·ª• th·ªÉ)
* [x] Refactor (T√°i c·∫•u tr√∫c): T√°ch logic "L∆∞u Transaction" t·ª´ `add_command` v√† `paid_command` ra th√†nh h√†m chung trong `src/bot/handlers.py` (ho·∫∑c controller ri√™ng) ƒë·ªÉ t√°i s·ª≠ d·ª•ng.
* [x] T·∫°o file `src/bot/nlp_engine.py`:
    * Vi·∫øt class `NLPEngine`.
    * Implement h√†m `parse_message(text) -> (type, name, amount, note)`.
    * S·ª≠ d·ª•ng Regex ƒë·ªÉ b·∫Øt pattern n·ª£/tr·∫£.
* [x] C·∫≠p nh·∫≠t `src/bot/handlers.py`:
    * Th√™m h√†m `nlp_message_handler(update, context)`.
    * G·ªçi `NLPEngine` ƒë·ªÉ ph√¢n t√≠ch.
    * N·∫øu parse th√†nh c√¥ng -> G·ªçi logic l∆∞u DB t∆∞∆°ng ·ª©ng.
* [x] ƒêƒÉng k√Ω `MessageHandler` (filters.TEXT & ~filters.COMMAND) trong `src/main.py`.

## 4. Dev Notes
* **Regex Suggestion:**
    * Debt: `r"^(?P<name>\S+)\s+(?:n·ª£|vay|mu·ªôn)\s+(?P<amount>\d+(?:[.,]\d+)?k?)(?:\s+(?P<note>.*))?$"`
    * Credit: `r"^(?P<name>\S+)\s+(?:tr·∫£|ƒë∆∞a|b√π)\s+(?P<amount>\d+(?:[.,]\d+)?k?)(?:\s+(?P<note>.*))?$"`
* **Flags:** D√πng `re.IGNORECASE` ƒë·ªÉ kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng (N·ª£/n·ª£).