# Story 1.2: Database Schema & Connection

**Tráº¡ng thÃ¡i:** Approved ğŸŸ¢

## 1. User Story
* **LÃ :** Developer
* **TÃ´i muá»‘n:** Thiáº¿t káº¿ báº£ng dá»¯ liá»‡u (Schema) vÃ  káº¿t ná»‘i Bot vá»›i PostgreSQL.
* **Äá»ƒ:** Dá»¯ liá»‡u ná»£/tráº£ Ä‘Æ°á»£c lÆ°u trá»¯ an toÃ n, khÃ´ng bá»‹ máº¥t khi Bot khá»Ÿi Ä‘á»™ng láº¡i.

## 2. Acceptance Criteria (TiÃªu chÃ­ cháº¥p nháº­n)
1. Káº¿t ná»‘i thÃ nh cÃ´ng tá»›i PostgreSQL thÃ´ng qua biáº¿n mÃ´i trÆ°á»ng `DATABASE_URL` trong `.env`.
2. Táº¡o Ä‘Æ°á»£c 4 báº£ng theo thiáº¿t káº¿ trong `docs/architecture.md`: `users`, `debtors`, `aliases`, `transactions`.
3. Sá»­ dá»¥ng `SQLAlchemy` (Async) Ä‘á»ƒ Ä‘á»‹nh nghÄ©a Models.
4. Cáº¥u hÃ¬nh `Alembic` Ä‘á»ƒ quáº£n lÃ½ migrations (táº¡o báº£ng tá»± Ä‘á»™ng).
5. Code tá»± Ä‘á»™ng xá»­ lÃ½ chuá»—i káº¿t ná»‘i: náº¿u `DATABASE_URL` báº¯t Ä‘áº§u báº±ng `postgres://`, hÃ£y Ä‘á»•i thÃ nh `postgresql+asyncpg://` Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i driver async.

## 3. Tasks (Nhiá»‡m vá»¥ cá»¥ thá»ƒ)
* [x] Cáº­p nháº­t `requirements.txt`: thÃªm `alembic`, `asyncpg`, `sqlalchemy`.
* [x] Táº¡o file `src/database/config.py`: Thiáº¿t láº­p `AsyncSession` vÃ  `create_engine`.
* [x] Táº¡o file `src/database/models.py`: Äá»‹nh nghÄ©a cÃ¡c class `User`, `Debtor`, `Alias`, `Transaction` vá»›i Ä‘Ãºng kiá»ƒu dá»¯ liá»‡u (Ä‘áº·c biá»‡t lÃ  `Decimal` cho tiá»n tá»‡).
* [x] Cháº¡y `alembic init migrations` táº¡i thÆ° má»¥c gá»‘c.
* [x] Cáº¥u hÃ¬nh `migrations/env.py` Ä‘á»ƒ nháº­n diá»‡n metadata tá»« models (quan trá»ng Ä‘á»ƒ autogenerate).
* [x] Cháº¡y lá»‡nh táº¡o migration file: `alembic revision --autogenerate -m "Initial migration"`.
* [x] Cháº¡y lá»‡nh apply db: `alembic upgrade head`.

## 4. Dev Notes
* **Driver:** Báº¯t buá»™c dÃ¹ng `asyncpg` cho hiá»‡u nÄƒng cao vá»›i Bot.
* **Schema Reference:** Xem ká»¹ pháº§n "3. Database Schema (ERD)" trong file `docs/architecture.md` Ä‘á»ƒ biáº¿t chi tiáº¿t cÃ¡c cá»™t vÃ  khÃ³a ngoáº¡i (Foreign Keys).